server:
  port: 8083

# Resilience4j 서킷 브레이커 설정
resilience4j.circuitbreaker:
  configs:
    # 'default' 설정: 모든 서킷 브레이커 인스턴스의 기본값
    default:
      failure-rate-threshold: 50 # (1) 실패율 임계값: 50%
      minimum-number-of-calls: 5 # (2) 최소 호출 수: 5번
      wait-duration-in-open-state: 10s # (3) OPEN 상태 유지 시간: 10초
      permitted-number-of-calls-in-half-open-state: 3 # (4) HALF_OPEN 상태 시도 횟수: 3번
      sliding-window-type: COUNT_BASED # (5) 슬라이딩 윈도우 타입: 횟수 기반
      sliding-window-size: 10 # (6) 슬라이딩 윈도우 크기: 최근 10회 호출

      # (참고) slow-call 관련 설정도 있지만, 우선 '실패(Exception)' 기반으로만 설정
      # slow-call-rate-threshold: 60
      # slow-call-duration-threshold: 2s

      # Resilience4j가 어떤 예외를 '실패'로 간주할지 명시적으로 등록합니다.
      # 기본값인 IOException, TimeoutException에 WebClientRequestException을 '추가'합니다.
      record-exceptions:
        - java.io.IOException
        - java.util.concurrent.TimeoutException
        # (1) 이 예외를 '실패'로 등록합니다.
        - org.springframework.web.reactive.function.client.WebClientRequestException

      # (참고) WebClientResponseException (503 에러)는
      # WebClientRequestException의 자식 클래스이므로,
      # (1) 부모 클래스만 등록해도 함께 처리됩니다.

  instances:
    # (★중요★) 우리가 사용할 서킷 브레이커의 고유 이름
    user-service-breaker:
      # 위에서 정의한 'default' 설정을 상속받아 사용
      base-config: default